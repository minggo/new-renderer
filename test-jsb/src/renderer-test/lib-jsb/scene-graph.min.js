(function(t,e){"use strict";function n(t){return t?(t^Math.random()*16>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,n)}let r=e.vec3.create();let i=e.quat.create();let l=e.mat3.create();let a=e.mat3.create();let h=e.mat4.create();class s{static mixin(t){Object.getOwnPropertyNames(s.prototype).forEach(function(e){if(t.prototype.hasOwnProperty(e)===false){Object.defineProperty(t.prototype,e,Object.getOwnPropertyDescriptor(s.prototype,e))}});t.prototype.__initNode=function(){this._id=n();this._enabled=true;this._parent=null;this._children=[];this.name="";this.lpos=e.vec3.new(0,0,0);this.lscale=e.vec3.new(1,1,1);this.lrot=e.quat.new(0,0,0,1)}}constructor(t){this._id=n();this._enabled=true;this._parent=null;this._children=[];this.name=t||"";this.lpos=e.vec3.new(0,0,0);this.lscale=e.vec3.new(1,1,1);this.lrot=e.quat.new(0,0,0,1)}get enabled(){return this._enabled}set enabled(t){if(this._enabled===t){return}this._enabled=t;if(this._onEnableChanged){this._onEnableChanged()}}get id(){return this._id}get parent(){return this._parent}get children(){return this._children}setParent(t){let e=this._parent;if(e===t){return false}let n=t;while(n){if(n===this){return false}n=n._parent}if(e){let t=e._children.length;for(let n=0;n<t;++n){if(e._children[n]===this){e._children.splice(n,1);break}}}this._parent=t;if(t){t._children.push(this)}if(this._onParentChanged){this._onParentChanged(e,t)}return true}insertAt(t,e){if(!e){return false}let n=this;while(n){if(n===e){return false}n=n._parent}let r=e._parent;let i=this._children.length;t=t<0?0:t>i?i:t;if(r){i=r._children.length;for(let n=0;n<i;++n){if(r._children[n]===e){if(r===this){if(n===t||n===t-1){return false}if(n<t-1){t=t-1}}r._children.splice(n,1);break}}}e._parent=this;this._children.splice(t,0,e);if(e._onParentChanged&&e._parent!==this){e._onParentChanged(r,this)}return true}append(t){if(!t){return false}let e=this;while(e){if(e===t){return false}e=e._parent}let n=t._parent;if(n){let e=n._children.length;for(let r=0;r<e;++r){if(n._children[r]===t){if(n===this&&r===e-1){return false}n._children.splice(r,1);break}}}t._parent=this;this._children.push(t);if(t._onParentChanged&&t._parent!==this){t._onParentChanged(n,this)}return true}remove(){if(this._parent){this._parent.removeChild(this)}}removeChild(t){let e=this._children.length;for(let n=0;n<e;++n){if(this._children[n]===t){this._children.splice(n,1);t._parent=null;if(t._onParentChanged){t._onParentChanged(this,null)}return true}}return false}lookAt(t,n){this.getWorldPos(r);e.vec3.sub(r,r,t);e.vec3.normalize(r,r);e.quat.fromViewUp(i,r,n);this.setWorldRot(i)}getWorldPos(t){e.vec3.copy(t,this.lpos);let n=this._parent;while(n){e.vec3.mul(t,t,n.lscale);e.vec3.transformQuat(t,t,n.lrot);e.vec3.add(t,t,n.lpos);n=n._parent}return t}setWorldPos(t){if(this._parent){this._parent.invTransformPoint(this.lpos,t);return}e.vec3.copy(this.lpos,t)}getWorldRot(t){e.quat.copy(t,this.lrot);let n=this._parent;while(n){e.quat.mul(t,n.lrot,t);n=n._parent}return t}setWorldRot(t){if(this._parent){this._parent.getWorldRot(this.lrot);e.quat.conjugate(this.lrot,this.lrot);e.quat.mul(this.lrot,this.lrot,t);return}e.quat.copy(this.lrot,t)}getWorldScale(t){this.getWorldRot(i);e.quat.conjugate(i,i);e.mat3.fromQuat(t,i);this.getWorldRS(l);e.mat3.mul(t,t,l);return t}invTransformPoint(t,n){if(this._parent){this._parent.invTransformPoint(t,n)}else{e.vec3.copy(t,n)}e.vec3.sub(t,t,this.lpos);e.quat.conjugate(i,this.lrot);e.vec3.transformQuat(t,t,i);e.vec3.inverseSafe(r,this.lscale);e.vec3.mul(t,t,r);return t}getLocalMatrix(t){e.mat4.fromRTS(t,this.lrot,this.lpos,this.lscale);return t}getWorldMatrix(t){this.getLocalMatrix(t);let n=this._parent;while(n){n.getLocalMatrix(h);e.mat4.mul(t,h,t);n=n._parent}return t}getWorldRT(t){this._getWorldPosAndRot(r,i);e.mat4.fromRT(t,i,r);return t}getWorldRS(t){e.mat3.set(l,this.lscale.x,0,0,0,this.lscale.y,0,0,0,this.lscale.z);e.mat3.fromQuat(a,this.lrot);if(this._parent){this._parent.getWorldRS(t);e.mat3.mul(t,t,a);e.mat3.mul(t,t,l)}else{e.mat3.mul(t,a,l)}return t}_getWorldPosAndRot(t,n){e.vec3.copy(t,this.lpos);e.quat.copy(n,this.lrot);let r=this._parent;while(r){e.vec3.mul(t,t,r.lscale);e.vec3.transformQuat(t,t,r.lrot);e.vec3.add(t,t,r.lpos);e.quat.mul(n,r.lrot,n);r=r._parent}}}function o(t,e,n=0){n+=1;let r=t.children.length;for(let i=0;i<r;++i){let r=t.children[i];let l=e(r,t,n);if(l!==false){o(r,e,n)}}}function u(t){let e=[];e.push(t);o(t,function(t){e.push(t)});return e}function c(t,e){e.remove();let n=t._parent;if(!n){return}t._parent=null;e._parent=n;let r=n._children.length;for(let i=0;i<r;++i){if(n._children[i]===t){n._children[i]=e;return}}}function f(t,e,n){if(t._enabled!==e){t._enabled=e;if(n){n(t,e);o(t,function(t){if(t._enabled){n(t,e);return true}return false})}}}function p(t,n=s,r=null){let i=new n;i.name=t.name;e.vec3.copy(i.lpos,t.lpos);e.vec3.copy(i.lscale,t.lscale);e.quat.copy(i.lrot,t.lrot);if(r){r(i,t)}return i}function _(t,e=s,n=null){let r=p(t,e,n);r._children=new Array(t._children.length);for(let i=0;i<t._children.length;++i){let l=t._children[i];let a=_(l,e,n);r._children[i]=a;a._parent=r}return r}function d(t,e=true){if(e&&!t._enabled){return false}let n=t._parent;while(n){if(!n._enabled){return false}n=n._parent}return true}function m(t,e){let n=e.split("/");function r(t,e){let i=t.children.length;let l=n[e];for(let a=0;a<i;++a){let i=t.children[a];if(i.name!==l){continue}if(e===n.length-1){return i}else{return r(i,e+1)}}return null}return r(t,0)}let g={walk:o,flat:u,replace:c,enable:f,clone:p,deepClone:_,enabledInHierarchy:d,find:m};t.Node=s;t.utils=g})(this.sgraph=this.sgraph||{},window.vmath);
//# sourceMappingURL=scene-graph.min.js.map